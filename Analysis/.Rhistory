"Cold Control", "Cold Inoculated"))
)
dodge = position_dodge(0.8)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 2.5, alpha=1,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.6)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=groups)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 2.5, alpha=1,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.6)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=groups)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(ti.ab, aes(x=dpi, y=elisa_od, color=groups))+
geom_point(aes(shape=sex), size=2)+
geom_line(aes(group = as.factor(band_number)), linewidth=0.1)+
scale_color_manual(values=treat_colors)+
facet_grid(
ever_infected ~ ever_diseased,
labeller = labeller(
ever_infected = c(`0` = "Never Infected", `1` = "Ever Infected"),
ever_diseased = c(`0` = "Never Diseased", `1` = "Ever Diseased")
)
)+
theme(strip.text = element_text(size=12))+
labs(x="Days Post Inoculation", y="ELISA OD", color="Treatment Groups", shape="Sex")
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 2.5, alpha=1,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.6)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=groups)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.15)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 2.5, alpha=1,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.5)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=groups)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.15)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(ti.ab, aes(x=dpi, y=elisa_od, color=groups))+
geom_point(aes(shape=sex), size=2)+
geom_line(aes(group = as.factor(band_number)), linewidth=0.1)+
scale_color_manual(values=treat_colors)+
facet_grid(
ever_infected ~ ever_diseased,
labeller = labeller(
ever_infected = c(`0` = "Never Infected", `1` = "Ever Infected"),
ever_diseased = c(`0` = "Never Diseased", `1` = "Ever Diseased")
)
)+
theme(strip.text = element_text(size=12))+
labs(x="Days Post Inoculation", y="ELISA OD", color="Treatment Groups", shape="Sex")
#Anova type II asks whether there is a main effect overall, averaged across the other variables
lm1_anova_II <- car::Anova(lm1, type = "II")
#options(contrasts = c("contr.treatment", "contr.poly"))
lm1_anova_III <- car::Anova(lm1, type = "III")
summary(lm1)
plot(allEffects(lm1))
#Model Predictions
mod <- lm1
# dat.new=expand.grid(#band_number = unique(ti.ab$band_number),
#                     temp = unique(ti.ab$temp),
#                     treatment= unique(ti.ab$treatment),
#                     dpi = unique(ti.ab$dpi))
dat.new <- dplyr::distinct(ti.ab[, c("temp","treatment","dpi")])
dat.new$yhat=predict(mod, type="response", newdata = dat.new, re.form = NA)
#prediction intervals
preds = predict(mod, type = "link", newdata = dat.new, se.fit =T, re.form= NA)
pr <- predict(mod, newdata = dat.new, type = "link", se.fit = TRUE, re.form = NA)
#bind se's and fitted points
dat.new = cbind(dat.new, preds)
#inverse link function
ilink <- family(mod)$linkinv
#back transform CIs
dat.new <- transform(dat.new,
Fitted = ilink(fit),
Upper = ilink(fit + (2*se.fit)),
Lower = ilink(fit - (2*se.fit)))
dat.new <- dat.new %>%
mutate(
groups = case_when(
temp == "Warm" & treatment == "Control"    ~ "Warm Control",
temp == "Warm" & treatment == "Inoculated" ~ "Warm Inoculated",
temp == "Cold" & treatment == "Control"    ~ "Cold Control",
temp == "Cold" & treatment == "Inoculated" ~ "Cold Inoculated"
),
groups = factor(groups,
levels = c("Warm Control", "Warm Inoculated",
"Cold Control", "Cold Inoculated"))
)
dodge = position_dodge(0.8)
ggplot(dat.new, aes(x = groups, y = yhat, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 3, alpha=0.75,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.6)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = Lower, ymax = Upper), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(dat.new, aes(x = groups, y = yhat, color = groups, shape=dpi)) +
geom_jitter(
data = ti.ab,
aes(y = elisa_od, color = groups, shape = dpi),
size = 3, alpha=0.75,
position = position_jitterdodge(dodge.width = 0.8, jitter.width=0.6)
) +
geom_point(size = 3, color="black", stroke = 1,
position = dodge) +
geom_errorbar(aes(ymin = Lower, ymax = Upper), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, name = "Treatment") +
scale_shape_manual(values = c(1, 17, 16))+
#facet_wrap(~ ever_diseased, nrow = 1) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# tidy or convert results
coef_fixed   <- broom.mixed::tidy(lm1, effects = "fixed", conf.int = TRUE)
coef_random  <- broom.mixed::tidy(lm1, effects = "ran_pars", conf.int = TRUE)
fit_glance   <- broom.mixed::glance(lm1)
anova_II_df  <- broom::tidy(lm1_anova_II)
anova_III_df <- broom::tidy(lm1_anova_III)
emm_df       <- as.data.frame(emm)
pairs_df     <- as.data.frame(pairs(emm, by = c("temp", "dpi"), adjust = "tukey"))
# combine into one named list
out_list <- list(
"Model_Fixed_Coeffs"     = coef_fixed,
"Model_Random_Vars"      = coef_random,
"Model_Fit_Summary"      = fit_glance,
"ANOVA_Type_II"          = anova_II_df,
"ANOVA_Type_III"         = anova_III_df,
"Estimated_Marginal_Means" = emm_df,
"Pairwise_Comparisons"   = pairs_df
)
####Fever Score####
source("dataCleaning_fever.R")
####Fever Score####
source("r_scripts/dataCleaning_fever.R")
####Fever Score####
source("r_scripts/dataCleaning_fever.R")
ti <- read.csv("TI22_merged_data.csv")
ti <- read.csv("data_frames/TI22_merged_data.csv")
+#Add column for total eye score by adding l and r eye score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(total_eye_score=(l_eye_score+r_eye_score))
#Add column for total eye score by adding l and r eye score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(total_eye_score=(l_eye_score+r_eye_score))
ti$quant_cutoff = 100
ti$sympt_cutoff = 0.1
#diseased = eye score
#infected = eye score or pathology >= cutoff
ti <- ti %>%
mutate(diseased= ifelse(total_eye_score>=sympt_cutoff, 1, 0),
sick = ifelse(total_eye_score>=sympt_cutoff | quantity >= quant_cutoff, 1, 0),
infected = ifelse(quantity >= quant_cutoff, 1, 0))
#new column with whether the bird is ever diseased
ti <- ti %>%
group_by(band_number) %>%
mutate(ever_diseased = ifelse(any(coalesce(diseased, 0) == 1), 1, 0),
ever_infected = ifelse(any(coalesce(infected, 0) == 1), 1, 0),
ever_sick = ifelse(any(coalesce(sick, 0) == 1), 1,0))%>%
ungroup()
#Add column for fever score by finding average score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(fever_score=((((l_min + l_max)/2) + (r_min + r_max)/2)/2))
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
)%>%
modify_header(
label ~ "**All Birds**"
)
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by=groups
)%>%
modify_header(
label ~ "**All Birds**"
)
ti
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
group_by(dpi, groups)%>%
tbl_summary(
by=groups
)%>%
modify_header(
label ~ "**All Birds**"
)
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
group_by(dpi, groups)%>%
tbl_summary(
by=dpi
)%>%
modify_header(
label ~ "**All Birds**"
)
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
#Add column for fever score by finding average score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(fever_score=((((l_min + l_max)/2) + (r_min + r_max)/2)/2))%>%
ungroup()
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ti.f <- ti %>%
filter(!is.na(fever_score))
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
ti.f <- ti.f %>%
filter(dpi !=24)
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
ti.f <- ti.f %>%
filter(dpi !=24)
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
anti_join(ti, ti.f, by=bird_ID)
ti
anti_join(ti, ti.f, by="bird_ID")
ti.f <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35) & !is.na(fever_score))
ti.fw <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35))
anti_join(ti.fw, ti.f, by="bird_ID")
missing.fever<-anti_join(ti.fw, ti.f, by="bird_ID")
View(missing.fever)
missing.fever<-anti_join(ti.fw, ti.f, by="bird_ID") %>%
dplyr::select(dpi, band_number, bird_ID, temp, treatment, fever_score, experiment_notes)
missing.fever
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
ti.f <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35) & !is.na(fever_score))
ti.fw <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35))
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
ti.fw %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
missing.fever<-anti_join(ti.fw, ti.f, by="bird_ID") %>%
dplyr::select(dpi, band_number, bird_ID, temp, treatment, fever_score, experiment_notes)
missing.fever
ti.f <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35) & !is.na(fever_score))
ti.fw <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35))
missing.fever<-anti_join(ti.fw, ti.f, by="bird_ID") %>%
dplyr::select(dpi, band_number, bird_ID, temp, treatment, fever_score, experiment_notes)
missing.fever
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
ti$groups
str(ti$groups)
ti <- ti %>%
dplyr::mutate(groups = factor(groups,
levels = c("Warm Control", "Warm Inoculated",
"Cold Control", "Cold Inoculated")))
#diseased = eye score
#infected = eye score or pathology >= cutoff
ti <- ti %>%
mutate(diseased= ifelse(total_eye_score>=sympt_cutoff, 1, 0),
sick = ifelse(total_eye_score>=sympt_cutoff | quantity >= quant_cutoff, 1, 0),
infected = ifelse(quantity >= quant_cutoff, 1, 0))
#new column with whether the bird is ever diseased
ti <- ti %>%
group_by(band_number) %>%
mutate(ever_diseased = ifelse(any(coalesce(diseased, 0) == 1), 1, 0),
ever_infected = ifelse(any(coalesce(infected, 0) == 1), 1, 0),
ever_sick = ifelse(any(coalesce(sick, 0) == 1), 1,0))%>%
ungroup()
#Add column for fever score by finding average score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(fever_score=((((l_min + l_max)/2) + (r_min + r_max)/2)/2))%>%
ungroup()
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ti.f <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35) & !is.na(fever_score))
ti.fw <- ti %>%
filter(dpi %in% c(0, 3, 7, 14, 18, 28, 35))
missing.fever<-anti_join(ti.fw, ti.f, by="bird_ID") %>%
dplyr::select(dpi, band_number, bird_ID, temp, treatment, fever_score, experiment_notes)
ti.f <- ti.f %>%
filter(dpi !=24)
ti.f %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**Fever; NA Removed**"
)
missing.fever
