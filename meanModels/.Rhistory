)
ti.rm <- ti.rm %>%
mutate(
groups = paste(temp, ifelse(treatment == "Inoculated", "Inoculated", "Control")),
groups = factor(groups, levels = lvl),
dpi    = factor(dpi)
)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi, groups=dpi)) +
geom_jitter(
data = ti.rm,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 2,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 2.5, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi, groups=dpi)) +
geom_jitter(
data = ti.rm,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 2.5, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = groups, y = response, color = groups, shape=dpi, groups=dpi)) +
geom_jitter(
data = ti.rm,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=dpi)) +
geom_jitter(
data = ti.rm,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(emm_df, aes(x = dpi, y = response, color = groups, groups=groups)) +
geom_jitter(
data = ti.rm,
aes(y = elisa_od, color = groups, shape = dpi),
alpha = 0.75, size = 3,
position = position_jitterdodge(dodge.width = 0.75, jitter.width=0.2)
) +
geom_point(size = 3, color="black",
position = dodge) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.0, color="black",
position = dodge) +
scale_color_manual(values = treat_colors, breaks = lvl, name = "Treatment") +
scale_shape_manual(values = c(0, 1, 16))+
#facet_wrap(~ dpi, nrow = 2) +
labs(x = "Treatment Group", y = "ELISA OD", shape = "Days Post Inoculation") +
theme(
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1)
)
#Using only birds with antibody levels for each dpi
ti.rm %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
source("dataCleaning_antibody.R")
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ti <- read.csv("ti_merged_data.csv")
#combine dpi 9 and 10
ti$dpi <- ifelse(ti$dpi %in% c(9, 10), "9", as.integer(ti$dpi))
ti$dpi <- as.integer(ti$dpi)
unique(ti$dpi)
ti$quant
#add infected and seropositivity thresholds
ti.cont <- ti%>%
filter(treatment == "Sham")%>%
drop_na(quantity)
ti.cont
range(ti.cont$quantity) #highest control quantity = 95.38
ti$quant_cutoff = 100
ti.cont$elisa_od
ti$seropos_cutoff = 0.061
ti$sympt_cutoff = 0.1
#Add column for total eye score by adding l and r eye score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(total_eye_score=(l_eye_score+r_eye_score))
#diseased = eye score
#infected = eye score or pathology >= cutoff
ti <- ti %>%
mutate(diseased= ifelse(total_eye_score>=sympt_cutoff, 1, 0),
sick = ifelse(total_eye_score>=sympt_cutoff | quantity >= quant_cutoff, 1, 0),
infected = ifelse(quantity >= quant_cutoff, 1, 0))
#new column with whether the bird is ever diseased
ti <- ti %>%
group_by(band_number) %>%
mutate(ever_diseased = ifelse(any(coalesce(diseased, 0) == 1), 1, 0),
ever_infected = ifelse(any(coalesce(infected, 0) == 1), 1, 0),
ever_sick = ifelse(any(coalesce(sick, 0) == 1), 1,0))%>%
ungroup()
#identify seropositive birds from quarantine in dataset
Qinf <- ti %>%
filter(dpi==-28)%>%
filter(elisa_od >=0.061)%>%
dplyr::select(band_number, elisa_od, groups, dpi)
Qinf
#remove birds that were seropositive dpi -28 from antibody analysis
ti <- ti %>%
filter(!band_number %in% c(2667, 2750))
ti <- read.csv("ti_merged_data.csv")
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
#combine dpi 9 and 10
ti$dpi <- ifelse(ti$dpi %in% c(9, 10), "9", as.integer(ti$dpi))
ti$dpi <- as.integer(ti$dpi)
unique(ti$dpi)
ti$quant
#add infected and seropositivity thresholds
ti.cont <- ti%>%
filter(treatment == "Sham")%>%
drop_na(quantity)
ti.cont
range(ti.cont$quantity) #highest control quantity = 95.38
ti$quant_cutoff = 100
ti.cont$elisa_od
ti$seropos_cutoff = 0.061
ti$sympt_cutoff = 0.1
#Add column for total eye score by adding l and r eye score
ti <- ti %>%
group_by(bird_ID) %>%
mutate(total_eye_score=(l_eye_score+r_eye_score))
#diseased = eye score
#infected = eye score or pathology >= cutoff
ti <- ti %>%
mutate(diseased= ifelse(total_eye_score>=sympt_cutoff, 1, 0),
sick = ifelse(total_eye_score>=sympt_cutoff | quantity >= quant_cutoff, 1, 0),
infected = ifelse(quantity >= quant_cutoff, 1, 0))
#new column with whether the bird is ever diseased
ti <- ti %>%
group_by(band_number) %>%
mutate(ever_diseased = ifelse(any(coalesce(diseased, 0) == 1), 1, 0),
ever_infected = ifelse(any(coalesce(infected, 0) == 1), 1, 0),
ever_sick = ifelse(any(coalesce(sick, 0) == 1), 1,0))%>%
ungroup()
#identify seropositive birds from quarantine in dataset
Qinf <- ti %>%
filter(dpi==-28)%>%
filter(elisa_od >=0.061)%>%
dplyr::select(band_number, elisa_od, groups, dpi)
Qinf
#remove birds that were seropositive dpi -28 from antibody analysis
ti <- ti %>%
filter(!band_number %in% c(2667, 2750))
#remove dpi that didn't have ELISA data run
ti <- ti %>%
filter(dpi %in% c(-28, 9, 28))
ab.miss <- ti %>%
filter(is.na(elisa_od)) %>%
dplyr::select(dpi, band_number, treatment, temp, elisa_od, total_eye_score)
ab.miss
ab.miss %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ab.miss %>%
dplyr::select(dpi, treatment, temp)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ab.miss %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ti %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ab.miss <- ti %>%
filter(is.na(elisa_od)) %>%
dplyr::select(dpi, band_number, treatment, temp, elisa_od, total_eye_score, groups)
ab.miss %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
ab.miss
ab.miss %>%
dplyr::select(dpi, treatment, temp, groups)%>%
tbl_summary(
by="dpi"
)%>%
modify_header(
label ~ "**All Birds**"
)
Qinf
ab.miss <- ti %>%
filter(is.na(elisa_od)) %>%
dplyr::select(dpi, band_number, treatment, temp, elisa_od, total_eye_score, groups)
ab.miss
#T+I 2022 Data Formatting
rm(list=ls())
setwd('/Users/jesse/Documents/Virginia Tech/Research/Temp + Immunity 2022/RAW DATA/data_frames/')
####read in + format assay files####
ti <- read.csv("Temp_Immunity_Master_Data_RAW.csv") #Master Data
phago <- read.csv("Phagocytosis_Raw.csv") #Phagocytosis Assay
m.phago <- phago %>%
dplyr::select('bird_ID', 'Well.1.WBC', 'Well.1.Phago', 'Well.2.Phago', 'Well.2.WBC',
'Well.3.Phago', 'Well.3.WBC', 'Well.4.WBC', 'Well.4.Phago') #format for merge
fever <-read.csv("fever_assay_raw.csv") #Fever Assay
m.fever <- fever %>%
dplyr::select(bird_ID, l_min, l_max, r_min, r_max) #format for merge
vital <- read.csv("temp_immunity_vital_data_raw.csv") #Vital Data
qpcr <- read.csv("TI22_qpcr_data_14Jun23.csv") #Pathogen Load
m.qpcr <- qpcr %>%
dplyr::select(qpcr_plate, well, bird_ID, cq_value, quantity, log10_quantity, extraction_plate,
extr_neg_cntrls, cq8, cq7, cq6, cq5, cq4, cq3, cq2, cq1, qpcr_neg_cntrls,
y_inter, r2, error) #format for merge
ab <- read.csv("mg_elisa.csv")
ab <- read.csv("TI22_antibodies.csv")
ab <- read.csv("TI22_antibodies.csv")
m.ab <- ab %>%
dplyr:: select(bird_ID, elisa_od, elisa_cv, exclude, reason) #format for merge
m.ab
exclude <- m.ab %>% filter(exclude == 1)
exclude
exclude_ab <- m.ab %>% filter(exclude == 1)
m.ab <- m.ab %>% filter(exclude == 0)
m.ab
####merge + format ti and vital data####
ti <- left_join(ti, vital, by='band_number') #merge ti+vital
ti <- ti %>%
dplyr::select(-stack.y, -cage.y, -treatment.y) #remove extra columns
ti
#rename columns
#names(ti)[names(ti) == "bird_ID.x"] <- "bird_ID"
names(ti)[names(ti) == "treatment.x"] <- "treatment"
names(ti)[names(ti) == "stack.x"] <- "stack"
names(ti)[names(ti) == "cage.x"] <- "cage"
#names(ti)[names(ti) == "room.x"] <- "room"
#names(ti)[names(ti) == "cap_date.x"] <- "cap_date"
#names(ti)[names(ti) == "Location.x"] <- "location"
names(ti)[names(ti) == "Sex"] <- "sex"
#print all instances of " "
ti[ti == ""]
#replace all " " with NA
ti[ti == ""] <- NA
#replace all "NA" with NA
ti[ti == "NA"] <- NA
#drop empty rows
ti.to.merge <- ti[rowSums(is.na(ti)) !=ncol(ti), ]
ti.to.merge
####merge ti and assays####
ti_assays <- list(ti.to.merge, m.phago, m.fever, m.qpcr, m.ab) #list of data frames
ti_assays
#merge assay dataframes
ti<- ti_assays %>%
reduce(left_join, by="bird_ID")
view(ti)
#remove pid 37 from analysis - data was only collected for RNAseq/qPCR analysis and is not used in any of the bioassay analyses
ti <- ti %>%
filter(dpi !=37)
#merge assay dataframes
ti<- ti_assays %>%
reduce(left_join, by="bird_ID")
#remove pid 37 from analysis - data was only collected for RNAseq/qPCR analysis and is not used in any of the bioassay analyses
ti <- ti %>%
filter(dpi !=37)
ti <- ti %>%
mutate(
## 1) Clean treatment and temp
treatment = factor(
treatment,
levels = c("Sham", "MG"),
labels = c("Control", "Inoculated")
),
temp = factor(
temp,
levels = c("TN", "ST"),
labels = c("Warm", "Cold")
),
## 2) Optional: a temp_names column (redundant with temp but fine)
temp_names = temp,  # already "Warm"/"Cold"
## 3) Group names: Warm/Cold × Control/Inoculated
groups = case_when(
temp == "Warm" & treatment == "Control"     ~ "Warm Control",
temp == "Warm" & treatment == "Inoculated"  ~ "Warm Inoculated",
temp == "Cold" & treatment == "Control"     ~ "Cold Control",
temp == "Cold" & treatment == "Inoculated"  ~ "Cold Inoculated",
TRUE ~ NA_character_
),
groups = factor(
groups,
levels = c("Warm Control", "Warm Inoculated",
"Cold Control", "Cold Inoculated")
),
## 4) (Optional) a clean inf_temp factor if you still need it
inf_temp = factor(
paste(treatment, temp, sep = "_"),
levels = c("Control_Warm", "Inoculated_Warm",
"Control_Cold", "Inoculated_Cold")
)
)
ti
m.ab <- m.ab %>%
filter(exclude == 0) %>%
select(-exclude, -reason)
####merge + format ti and vital data####
ti <- left_join(ti, vital, by='band_number') #merge ti+vital
ti <- ti %>%
dplyr::select(-stack.y, -cage.y, -treatment.y) #remove extra columns
#rename columns
#names(ti)[names(ti) == "bird_ID.x"] <- "bird_ID"
names(ti)[names(ti) == "treatment.x"] <- "treatment"
names(ti)[names(ti) == "stack.x"] <- "stack"
names(ti)[names(ti) == "cage.x"] <- "cage"
#names(ti)[names(ti) == "room.x"] <- "room"
#names(ti)[names(ti) == "cap_date.x"] <- "cap_date"
#names(ti)[names(ti) == "Location.x"] <- "location"
names(ti)[names(ti) == "Sex"] <- "sex"
#print all instances of " "
ti[ti == ""]
#replace all " " with NA
ti[ti == ""] <- NA
#replace all "NA" with NA
ti[ti == "NA"] <- NA
#drop empty rows
ti.to.merge <- ti[rowSums(is.na(ti)) !=ncol(ti), ]
####merge ti and assays####
ti_assays <- list(ti.to.merge, m.phago, m.fever, m.qpcr, m.ab) #list of data frames
#merge assay dataframes
ti<- ti_assays %>%
reduce(left_join, by="bird_ID")
#remove pid 37 from analysis - data was only collected for RNAseq/qPCR analysis and is not used in any of the bioassay analyses
ti <- ti %>%
filter(dpi !=37)
#T+I 2022 Data Formatting
rm(list=ls())
setwd('/Users/jesse/Documents/Virginia Tech/Research/Temp + Immunity 2022/RAW DATA/data_frames/')
####read in + format assay files####
ti <- read.csv("Temp_Immunity_Master_Data_RAW.csv") #Master Data
phago <- read.csv("Phagocytosis_Raw.csv") #Phagocytosis Assay
m.phago <- phago %>%
dplyr::select('bird_ID', 'Well.1.WBC', 'Well.1.Phago', 'Well.2.Phago', 'Well.2.WBC',
'Well.3.Phago', 'Well.3.WBC', 'Well.4.WBC', 'Well.4.Phago') #format for merge
fever <-read.csv("fever_assay_raw.csv") #Fever Assay
m.fever <- fever %>%
dplyr::select(bird_ID, l_min, l_max, r_min, r_max) #format for merge
vital <- read.csv("temp_immunity_vital_data_raw.csv") #Vital Data
qpcr <- read.csv("TI22_qpcr_data_14Jun23.csv") #Pathogen Load
m.qpcr <- qpcr %>%
dplyr::select(qpcr_plate, well, bird_ID, cq_value, quantity, log10_quantity, extraction_plate,
extr_neg_cntrls, cq8, cq7, cq6, cq5, cq4, cq3, cq2, cq1, qpcr_neg_cntrls,
y_inter, r2, error) #format for merge
ab <- read.csv("TI22_antibodies.csv")
m.ab <- ab %>%
dplyr:: select(bird_ID, elisa_od, elisa_cv, exclude, reason) #format for merge
exclude_ab <- m.ab %>% filter(exclude == 1)
m.ab <- m.ab %>%
filter(exclude == 0) %>%
select(-exclude, -reason)
####merge + format ti and vital data####
ti <- left_join(ti, vital, by='band_number') #merge ti+vital
ti <- ti %>%
dplyr::select(-stack.y, -cage.y, -treatment.y) #remove extra columns
#rename columns
#names(ti)[names(ti) == "bird_ID.x"] <- "bird_ID"
names(ti)[names(ti) == "treatment.x"] <- "treatment"
names(ti)[names(ti) == "stack.x"] <- "stack"
names(ti)[names(ti) == "cage.x"] <- "cage"
#names(ti)[names(ti) == "room.x"] <- "room"
#names(ti)[names(ti) == "cap_date.x"] <- "cap_date"
#names(ti)[names(ti) == "Location.x"] <- "location"
names(ti)[names(ti) == "Sex"] <- "sex"
#print all instances of " "
ti[ti == ""]
#replace all " " with NA
ti[ti == ""] <- NA
#replace all "NA" with NA
ti[ti == "NA"] <- NA
#drop empty rows
ti.to.merge <- ti[rowSums(is.na(ti)) !=ncol(ti), ]
####merge ti and assays####
ti_assays <- list(ti.to.merge, m.phago, m.fever, m.qpcr, m.ab) #list of data frames
#merge assay dataframes
ti<- ti_assays %>%
reduce(left_join, by="bird_ID")
#remove pid 37 from analysis - data was only collected for RNAseq/qPCR analysis and is not used in any of the bioassay analyses
ti <- ti %>%
filter(dpi !=37)
ti <- ti %>%
mutate(
## 1) Clean treatment and temp
treatment = factor(
treatment,
levels = c("Sham", "MG"),
labels = c("Control", "Inoculated")
),
temp = factor(
temp,
levels = c("TN", "ST"),
labels = c("Warm", "Cold")
),
## 2) Optional: a temp_names column (redundant with temp but fine)
temp_names = temp,  # already "Warm"/"Cold"
## 3) Group names: Warm/Cold × Control/Inoculated
groups = case_when(
temp == "Warm" & treatment == "Control"     ~ "Warm Control",
temp == "Warm" & treatment == "Inoculated"  ~ "Warm Inoculated",
temp == "Cold" & treatment == "Control"     ~ "Cold Control",
temp == "Cold" & treatment == "Inoculated"  ~ "Cold Inoculated",
TRUE ~ NA_character_
),
groups = factor(
groups,
levels = c("Warm Control", "Warm Inoculated",
"Cold Control", "Cold Inoculated")
),
## 4) (Optional) a clean inf_temp factor if you still need it
inf_temp = factor(
paste(treatment, temp, sep = "_"),
levels = c("Control_Warm", "Inoculated_Warm",
"Control_Cold", "Inoculated_Cold")
)
)
ti
View(ti)
#tibble w/ number of birds per dpi in each treatment
t1 <- ti%>%
group_by(dpi, groups)%>%
summarize(count = n())
t1
write.csv(ti, "/Users/jesse/Documents/Virginia Tech/Research/Temp + Immunity 2022/RAW DATA/ti_merged_data.csv", row.names=FALSE)
rm(list=ls())
write.csv(ti, "/Users/jesse/Documents/Virginia Tech/Research/Temp + Immunity 2022/RAW DATA/data_frames/ti_merged_data.csv", row.names=FALSE)
write.csv(ti, "/Users/jesse/Documents/Virginia Tech/Research/Temp + Immunity 2022/RAW DATA/data_frames/TI22_merged_data.csv", row.names=FALSE)
